(function(n){app.modals.CreateOrEditSalesOrderModal=function(){function r(){n(".subcat-set").each(function(){var t=n(this).index();n(":input",this).each(function(){this.name=this.name.replace(/[0-9]+/,t);this.id=this.id.replace(/[0-9]+/,t)});n(this).find(".field-validation-valid, .field-validation-error").each(function(){var r=n(this).attr("data-valmsg-for"),i=n(this).attr("data-valmsg-for").replace(/[0-9]+/,t);n(this).attr("data-valmsg-for",i)})})}function u(n,t,i,r){var u,f,e;for(n+="",u=n.indexOf(t),f="",u!==-1&&(f=i+n.substring(u+1,n.length),n=n.substring(0,u)),e=/(\d+)(\d{3})/;e.test(n);)n=n.replace(e,"$1"+r+"$2");return n+f}function e(){var t=0,i;n(".line-amount").each(function(){var i=this.value.replace(/\./g,""),r;isNaN(i)||i.length===0?i.length!==0&&n(this).css("background-color","red"):(r=n(this).parents(".subcat-set"),r.is(":visible")&&(t+=parseFloat(i),n(this).addClass("bg-secondary")))});i=u(t.toFixed(0),".",",",".");n("#Amount").val(i);n("#Amount").addClass("bg-secondary font-weight-bold")}function f(){var t=n(".subcat-set:visible").length;t<2?n(".subcat-set .delete-subcat").hide():n(".subcat-set .delete-subcat").show()}var s=abp.services.app.salesOrders,i,t=null,h=new app.ModalManager({viewUrl:abp.appPath+"Portal/SalesOrders/CustomerLookupTableModal",scriptUrl:abp.appPath+"view-resources/Areas/Portal/Views/SalesOrders/_SalesOrderCustomerLookupTableModal.js",modalClass:"CustomerLookupTableModal"}),o;this.init=function(r){var u,f,e;i=r;u=i.getModal();u.find(".date-picker").datetimepicker({locale:abp.localization.currentLanguage.name,format:"L"});u.find("#Id").length||(f=new Date,e=f.getDate()+"/0"+(f.getMonth()+1)+"/"+f.getFullYear(),u.find(".date-picker").val(e));u.find("#CustomerId").select2({width:"100%"}).on("change",function(){n(this).valid()});t=i.getModal().find("form[name=SalesOrderInformationsForm]");t.validate();u.find(".modal-dialog").addClass("modal-xxl")};n("#OpenCustomerLookupTableButton").click(function(){var n=t.serializeFormToObject();h.open({id:n.customerId,displayName:n.customerName},function(n){t.find("input[name=customerName]").val(n.displayName);t.find("input[name=customerId]").val(n.id)})});n("#ClearCustomerNameButton").click(function(){t.find("input[name=customerName]").val("");t.find("input[name=customerId]").val("")});n("#AddOrderLine").click(function(t){t.preventDefault();var i=n(".subcat-set:last-child").clone(!0);i.show();i.find(":input").each(function(){n(this).val("");n(this).hasClass("mark-for-delete")&&n(this).val("False");n(this).hasClass("Id")&&n(this).val("0")});o.append(i);r();f()});this.save=function(){if(t.valid()){if(n("#SalesOrder_CustomerId").prop("required")&&n("#SalesOrder_CustomerId").val()==""){abp.message.error(app.localize("{0}IsRequired",app.localize("Customer")));return}var r=t.toObject({mode:"first"});i.setBusy(!0);s.createOrEdit(r).done(function(){abp.notify.info(app.localize("SavedSuccessfully"));i.close();abp.event.trigger("app.createOrEditSalesOrderModalSaved")}).always(function(){i.setBusy(!1)})}};o=n(".subcat-sets");f();r();n(".calc").on("keyup",function(){var t=n(this).attr("name"),o=t.indexOf("[")+1,h=t.indexOf("]",o),i=t.substring(o,h),c='input[name="SalesOrderLines['+i+'].Quantity"',l='input[name="SalesOrderLines['+i+'].UnitPrice"',a='input[name="SalesOrderLines['+i+'].LineAmount"',r=n(c).val(),f=n(l).val(),s;r=r.replace(/\./g,"");f=f.replace(/\./g,"");s=u((f*r).toFixed(0),".",",",".");n(a).val(s);e()});n(".number-format").keyup(function(t){t.which>=37&&t.which<=40&&t.preventDefault();n(this).val(function(n,t){return t=t.replace(/\./g,""),u(t,".",",",".")})});n(".delete-subcat").click(function(t){t.preventDefault();n(this).parents(".subcat-set").find(".mark-for-delete").val("true");var i=n(this).parents(".subcat-set").find(".Id").val();i==="0"?n(this).parents(".subcat-set").remove():n(this).parents(".subcat-set").hide();r();f();e()})}})(jQuery);